#!/bin/bash

# Termux permission
termux-setup-storage

# update and upgrade package
pkg update -y
pkg upgrade -y

# Function to check if a command exists
command_exists() {
  command -v "$1" >/dev/null 2>&1
}

# Ensure directories exist before proceeding
mkdir -p ~/.cache/crontab
mkdir -p ~/bin

# Install cronie if not already installed
if ! command_exists cronie; then
  echo "Installing cronie..."
  pkg install -y cronie
fi

# Install termux-api if not already installed
if ! command_exists termux-sms-send; then
  echo "Installing termux-api..."
  pkg install -y termux-api
fi

# Download and install send_sms.sh script to ~/bin/sms
echo "Downloading the SMS script..."
curl -s -o ~/bin/sms https://raw.githubusercontent.com/robertneed20k/auto-goodmorning/main/send_sms.sh
if [ $? -ne 0 ]; then
  echo "Failed to download the SMS script. Please check the URL and your internet connection."
  exit 1
fi

# Make the script executable
chmod +x ~/bin/sms

# Ensure ~/bin is in PATH
if [[ ":$PATH:" != *":$HOME/bin:"* ]]; then
  echo 'export PATH="$HOME/bin:$PATH"' >> ~/.bashrc
  source ~/.bashrc  # Reload .bashrc to apply the new PATH
fi

# Debugging information
echo "Current PATH: $PATH"
echo "Checking if 'sms' command is available: $(command -v sms)"

# Cleaner
clear

echo "Installation complete! Use 'sms' to configure the SMS sender."
